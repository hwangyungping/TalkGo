# 同城快递系统架构设计

## 项目背景

通达是某上市公司全资投资成立的一家物流快递公司，主要进行同城快递业务，公司刚刚成立，组建 20 人技术部门，准备两个月后系统开发完成上线。

## 需求分析

### 功能需求

同城快递系统主要功能包括用户下单，用户提供货品，用户收货；快递员抢单，快递员去指定地点收货，快递员送货达到目的地。常用场景如下：
1. 用户通过APP发起快递下单请求并支付
2. 快递员通过 APP 上报自己的地理位置，每 30 秒上报一次
3. 后台系统收到快递下单请求后，向距离用户直线距离 5km 内的所有快递员发送通知
4. 快递员通过APP进行抢单，第一个抢单的快递员得到配单，系统向其发送用户详细地址
5. 快递员联系用户收到快递，取货成功后记录到系统中：已收件
6. 快递员将快递送到目的地，送货成功后记录到系统中：已送达



### 用例图

![1609914702395](https://github.com/hwangyungping/TalkGo/blob/master/架构师训练营-第一期/images/1609914702395.png)

![1609914702395](.\images\1609914702395.png)



### 非功能需求

**扩展性：**

系统预计上线三个月，日订单超过 1 万，按2万进行设计；一年后，日单超过 50 万，按100万进行设计。

架构应满足弹性伸缩要求。

**性能要求：**

- 查询性能：平均响应时间 < 500ms, 95%响应时间 < 800ms
- 下单性能：平均响应时间 < 800ms, 95%响应时间 < 1000ms

**可用性：**

- 系统核心功能可用性： > 99.9%

**安全：**

- 系统安全性目标：可拦截 XSS 攻击，SQL 注入，CSRF 攻击，密码数据散列加密，客户端数据 HTTPS 加密，外部系统间通信加密。



## 系统部署图

![1610001120997](https://github.com/hwangyungping/TalkGo/blob/master/架构师训练营-第一期/images/1610001120997.png)

![1610001120997](.\images\1610001120997.png)

部署说明：
CDN用来加速用户图片访问速度
负载均衡服务器早起采用Nginx部署，将来并发量大的时候该用LVS部署
网关服务器早期采用双机部署，未来根据业务量持续扩容
微服务框架采用Dubbo
消息队列采用ActiveMQ
早期不准备部署Redis，快递员位置直接记录在配单微服务中
数据库采用MySQL并配置主从复制



## 下单抢单场景的业务活动图

![1610001383491](https://github.com/hwangyungping/TalkGo/blob/master/架构师训练营-第一期/images/1610001383491.png)

![1610001383491](.\images\1610001383491.png)



## 下单抢单场景的服务器时序模型

![1610001428161](https://github.com/hwangyungping/TalkGo/blob/master/架构师训练营-第一期/images/1610001428161.png)

![1610001428161](.\images\1610001428161.png)



## 订单状态图模型

![1610001407510](https://github.com/hwangyungping/TalkGo/blob/master/架构师训练营-第一期/images/1610001407510.png)

![1610001407510](.\images\1610001407510.png)