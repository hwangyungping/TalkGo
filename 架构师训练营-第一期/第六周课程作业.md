# 第 六周课程作业



### 题目一

简述CAP 原理。



CAP原理说，一个数据分布式系统不可能同时满足C和A和P这3个条件。C：Consistency即一致性，A：Availability即可用性，P：Partiton tolerence，即分区容忍性。

在设计系统时，不要将精力浪费在如何设计能满足三者的完美分布式系统，而是应该进行取舍。在分布式系统必须要满足分区耐受性的前提下，可用性和一致性无法同时满足，也就是说需要在C：Consistency和A：Availability中做抉择。

虽然说我们设计系统时不能同时保证拥有三点。但是也并不是说，保证了其中2点后，就要完全抛弃另外一点。只是相对的要做一些牺牲。比如在保证CP的情况下，虽然没办法保证高可用性，但这不意味着可用性为0，我们可以通过合理的设计尽量的提高可用性，让可用性尽可能的接近100%。同理，在AP的情况下，也可以尽量的保证数据的一致性，或者实现弱一致性，即最终一致性。



### 题目二

针对Doris 案例，请用UML 时序图描述Doris 临时失效的处理过程（包括判断系统进入临时失效状态，临时失效中的读写过程，失效恢复过程）。
参考《海量分布式存储系统Doris 的高可用架构设计分析.pdf》



![1604125802211.png](https://github.com/hwangyungping/TalkGo/blob/master/架构师训练营-第一期/images/1604125802211.png)



![1604125802211](.\images\1604125802211.png)



这里重点描述下失效恢复过程：

存储服务器1临时失效，并在可接受时间内恢复。恢复后存储服务器1重新向管理中心服务器注册；

管理中心服务器向存储服务器1进行仲裁检测，检测通过后，存储服务器1进入临时失效恢复状态。管理中心服务器将存储服务器1的失效恢复状态通知各应用服务器，进入失效恢复过程。

应用服务器将存储服务器1关联的日志服务器写操作停止，重新向存储服务器1进行写同步。

管理中心服务器将存储服务器1的失效恢复状态通知日志服务器，日志服务器启动数据迁移操作，将存储服务器1的失效期间的数据写入存储服务器1。此时存储服务器1存在并发写操作，从日志服务器的数据迁移写，和应用服务器的同步写。

日志服务器数据迁移操作完成后，通知管理中心服务器。

管理中心服务器将存储服务器1状态变迁为失效成功状态。并通知各应用服务器。

后续存储服务器1支持read读操作。

