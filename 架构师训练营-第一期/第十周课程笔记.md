# 第十周课程笔记

## 什么是微服务

微服务相比于服务化又有什么不同呢？

**服务拆分粒度更细。**微服务可以说是更细维度的服务化，小到一个子模块，只要该模块依赖的资源与其他模块都没有关系，那么就可以拆分为一个微服务。

**服务独立部署。**每个微服务都严格遵循独立打包部署的准则，互不影响。比如一台物理机上可以部署多个 Docker 实例，每个 Docker 实例可以部署一个微服务的代码。

**服务独立维护。**每个微服务都可以交由一个小团队甚至个人来开发、测试、发布和运维，并对整个生命周期负责。

**服务治理能力要求高。**因为拆分为微服务之后，服务的数量变多，因此需要有统一的服务治理平台，来对各个服务进行管理。



## 微服务与限界上下文

我们创建微服务时，需要创建一个高内聚、低耦合的微服务。而 DDD 中的限界上下文则完美匹配微服务要求，我们甚至可以将该限界上下文理解为一个微服务进程。

限界上下文：一个由显示边界限定的特定职责。领域模型便存在于这个边界之内。在边界内，每一个模型概念，包括它的属性和操作，都具有特殊的含义。



微服务落地注重：

- 业务先行，理顺业务边界和依赖，技术知识手段而不是目的
- 先有独立的模块，后有分布式的服务
- 明确的目的，实现业务复用、清晰的边界和分布式的性能，最后再决定技术以及框架
- 技术架构上则关注系统模块之间是否充分解耦，可以自由地选择合适的技术架构，去中心化地治理技术和数据。

领域设计的步骤一般如下：

1. 根据需求划分出初步的领域和限界上下文，以及上下文之间的关系；
2. 进一步分析每个上下文内部，识别出哪些是实体，哪些是值对象；
3. 对实体、值对象进行关联和聚合，划分出聚合的范畴和聚合根；
4. 为聚合根设计仓储，并思考实体或值对象的创建方式；
5. 在工程中实践领域模型，并在实践中检验模型的合理性，倒推模型中不足的地方并重构。



## 康威定律与上下文映射

不同的界限上下文中，也就是不同的子系统或者模块之间会有各种各样的交互合作；DDD 使用上下文映射来设计这种交互。但是我个人的亲身感觉是，上下文中最重要的交互合作是人：

任何组织在设计一套系统（广义概念上的系统）时，所交付的设计方案在结构上都与该组织的沟通结构保持一致。



在进行上下文划分之后，我们还需要进一步梳理上下文之间的关系，最重要的是要梳理人的关系。康威定律告诉我们系统结构应尽量的与组织结构保持一致。也就是说团队结构应该和限界上下文保持一致，好处显而易见：

1. 每个团队在它的上下文中能够更加明确自己领域内的概念，因为上下文是领域的解释系统；
2. 对于限界上下文之间发生交互，团队与上下文的一致性，能够保证我们明确对接的团队和依赖的上下游。
3. 每个团队内部也可以更快地构建由团队，开发人员，领域专家和其他参与者共享的语言，从而使得团队内开发直接更好的对接。

理清人与人的关系后，再去分配任务便可顺理成章：每个开发人员都可全身心地投入到相关的单独的上下文中；上下文映射图反过来也可以知道上下游的依赖关系，从而实现更好的对接。



## 下一代微服务架构Service Mesh

Service Mesh 以轻量级的网络代理的方式与应用的代码部署在一起，用于保证服务与服务之间调用的可靠性，这与传统的微服务架构有着本质的区别，在我看来这么做主要是出于两个原因。

1. 跨语言服务调用的需要

2. 云原生应用服务治理的需要。

Service Mesh 实现的关键就在于两点：

一个是上面提到的轻量级的网络代理也叫 SideCar，它的作用就是转发服务之间的调用；

一个是基于 SideCar 的服务治理也被叫作 Control Plane，它的作用是向 SideCar 发送各种指令，以完成各种服务治理功能。



## **参考**

大型网站技术架构-李智慧

从0开始学微服务

组件设计原则 https://www.jianshu.com/p/42f8e6e624a7