# 第十一周课程笔记

## 安全架构

### XSS 攻击

Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。



### SQL 注入

所谓 SQL 注入，就是通过把 SQL 命令插入到 Web 表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的 SQL 命令



### CSRF 攻击

Cross-site request forgery, 跨站请求伪造。是指黑客引诱用户打开黑客的网站，在黑客的网站中，利用用户的登录状态发起跨站请求。



### 其他攻击和漏洞

- Error Code： Web 服务器输出的错误信息，能帮助黑客寻找系统漏洞
- HTML 注释：显示在客户端 HTML 中的注释给黑客攻击造成便利
- 文件上传：上传可执行文件可能危及后台程序
- 路劲遍历：URL 中显示的相对路径，能帮助黑客程序遍历未开放的目录和文件



## 信息加密

### 单向散列

单项散列加密的特性是：

- 根据任意长度的信息计算固定长度的散列值
- 能快速计算散列值
- 消息不同散列值不同
- 通过散列值不能反算出消息

### 对称加密

对称加密就是最传统的加密计算：加密和解密使用同一个密钥。加密解密过程：

1. 明文->密钥加密->密文
2. 密文->密钥解密->明文

由于加解密使用的是同一个密钥，因此如何把密钥安全地传递到解密者手上就成了必须要解决的问题。

### 非对称加密

对称加密算法又称现代加密算法。非对称加密算法需要一对密钥：公开密钥和私有密。如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密。如果用私有密钥对数据进行加密，只有用对应的公开密钥才能解密。



## 高可用系统与架构

### 度量指标

**可用性指标**

业界通常用多少个9来衡量网站的可用性，如 QQ 的可用性是4个9，即 QQ 服务99.99% 可用，这意味着 QQ 服务要保证其在所有运行时间中，只有0.01% 的时间不可用，也就是一年中大约53分钟不可用。

**故障分类管理**

**故障处理流程及考核**

**引起故障的原因**

- 硬件故障
- 软件 bug
- 系统发布
- 并发压力
- 网络攻击
- 外部灾害

### 系统架构

#### 解耦

- 高内聚、低耦合的组件设计原则
- 面向对象基本设计原则
- 面向对象设计模式
- 领域驱动设计建模

#### 隔离

- 业务与子系统隔离
- 微服务与中台架构
- 生产者消费者隔离
- 虚拟机与容器隔离

#### 异步

- 多线程编程
- 反应式编程
- 异步通信网络编程
- 事件驱动异步架构

#### 备份

- 集群设计
- 数据库复制：CAP原理

#### Failover （失效转移）

- 数据库主主失效转移。
- 负责均衡失效转移。

#### 事务补偿

- 传统事务的 ACID：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation，又称独立性）、持久性（Durability）。
- 分布式事务的 BASE：基本可用（Basic Availability）、软状态（Soft-State）、最终一致性（Eventual Consistency）。

事务补偿：通过执行业务逻辑逆操作，使事务回滚到事务前状态。



#### 重试

远程服务可能会由于线程阻塞、垃圾回收或者网络抖动，而无法及时返还响应，调用者可以通过重试的方式修复单词调用的故障。

#### 熔断

当某个服务出现故障，响应延迟或者失败率增加，继续调用这个服务会导致调用者请求阻塞，资源消耗增加，进而出现服务级联失效，这种情况下使用断路器阻断对故障服务的调用。

- 断路器三种状态：关闭，打开，半开。
- Spring Cloud 断路器实现：Hystrix

#### 限流

在高并发场景下，如果系统的访问量超过了系统的承受能力，可以通过限流对系统进行保护。限流是指对系统的用户请求进行流量限制，如果访问量超过了系统的最大处理能力，就会丢弃一部分的用户请求，保证整个系统可用，保证大部分用户是可以访问系统的。这样虽然有一部分用户的请求被丢弃，产生了部分不可用，但还是好过整个系统崩溃，所有的用户都不可用要好。

限流的几种方法：

- 计数器算法（固定窗口，滑动窗口）
- 令牌桶算法
- 漏桶算法

#### 自适应限流

没有提前的人工评估，便没有提前的评估过时与人的评估疏漏/错误！

- 实时自动评估QPS
- 业务流量的不确定性与技术方案的自适应天上一对！

#### 降级

有一些系统功能是非核心的，但是它也给系统产生了非常大的压力，比如说在电商系统中又确认收货这个功能，即便我们不去确认收货，系统也会超时自动确认收货。

但是实际上确认收货这个操作是一个非常重的操作，因为它会对数据库产生很大的压力：它要进行更改订单状态，完成支付确认，并进行评价等一系列操作。如果在系统高并发的时候去完成这些操作，那么会对系统雪上加霜，使系统的处理能力更加恶化。

解决办法就是在系统高并发的时候，比如说像淘宝双11 的时候，当前可能整天系统都处于一种极限的高并发访问压力之下，这时候就可以将确认收货、评价这些非核心的功能关闭，将宝贵的系统资源留下来，给正在购物的人，让他们去完成交易。

#### 异地多活

如果整个数据中心都不可用，比如说数据中心所在城市遭遇了地震，机房遭遇了火灾或者停电，这样的话，不管我们的设计和系统多么的高可用，系统依然是不可用的。

为了解决这个问题，同时也为了提高系统的处理能力和改善用户体验，很多大型互联网应用都采用了异地多活的多机房机构策略，也就是说数据中心分布在多个不同地点的机房里，这些机房都可以对外提供服务，用户可以连接任何一个机房进行访问，这样每个机房都可以提供完整的系统服务，即使某一个机房不可使用，机房也不会宕机，依然保持可用。

异地多活的难点是数据一致。



## **参考**

大型网站技术架构-李智慧

从0开始学微服务

组件设计原则 https://www.jianshu.com/p/42f8e6e624a7